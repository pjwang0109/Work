<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>帳號檢核</title>
  <link rel="stylesheet" href="./02-jQuery.css" />
</head>
<body>
  <h1>帳號產生程式</h1>
  <section id="pink">
    <!-- elevenAccount (11碼) -->
    <div class="elevenNum">
      <label for="startAccount">起始帳號：</label>
      <input type="text" id="startAccount" name="startAccount" required />
    </div>

    <!-- amount (數量) -->
    <div class="amount">
      <label for="accountCount">帳號數：</label>
      <input
        type="number"
        id="accountCount"
        name="accountCount"
        min="1"
        max="9999"
        required
      />
    </div>

    <button class="btn" type="button">產生帳號</button>
  </section>

  <!-- <h3>產生帳號如下:</h3> -->
  <div id="result"></div>

  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"
    integrity="sha512-+k1pnlgt4F1H8L7t3z95o3/KO+o78INEcXTbnoJQ/F2VqDVhWoaiVml/OEHv9HsVgxUaVW+IbiZPUJQfF/YxZw=="
    crossorigin="anonymous"
  ></script>

  <script>
    $(document).ready(function () {
      // Focus 起始帳號的輸入框
      $("#startAccount").focus();

      $(".btn").click(function () {
        produceID();
      });

      // 按下 Enter
      $("body").keypress(function (e) {
        if (e.which === 13) {
          produceID();
        }
      });
    });

    function produceID() {
      let startAccount = $("#startAccount").val();
      let accountCount = parseInt($("#accountCount").val());

      // 檢查起始帳號長度
      if (startAccount.length !== 11) {
        alert("起始帳號長度錯誤");
        return;
      }

      // 檢查起始帳號是否為數字
      if (!/^\d+$/.test(startAccount)) {
        alert("起始帳號需為數字");
        return;
      }

      // 分行別
      let bankCode = startAccount.substring(0, 3);

      // 科目
      let subject = startAccount.substring(3, 5);

      // 檢查分行別
      if (!(bankCode >= "001" && bankCode <= "099") || bankCode === "019") {
        alert("分行別錯誤");
        return;
      }

      // 檢查科目別
      if (!["10", "20", "30", "40", "50", "51", "66", "77", "88"].includes(subject)) {
        alert("科目別錯誤");
        return;
      }

      // 檢查帳號數
      if (accountCount < 1 || accountCount > 9999) {
        alert("帳號數錯誤");
        return;
      }

      let result = "";
      let multiplyNum = [5, 4, 3, 2, 8, 7, 6, 5, 4, 3, 2];
      let lastSixNum = startAccount.substring(5, 11);

      for (let i = 0; i < accountCount; i++) {
        let newAccount = "";
        let checkSum = 0;

        if (subject === "20" || (bankCode >= "001" && bankCode <= "007")) {
          // Case (a)
          newAccount = "00000" + lastSixNum;
        } else {
          // Case (b)
          newAccount = startAccount.substring(0, 11);
        }

        // Calculate checksum
        for (let j = 0; j < 11; j++) {
          checkSum += parseInt(newAccount[j]) * multiplyNum[j];
        }

        let remainder = checkSum % 11;
        let checkDigit = 0;

        if (remainder === 0) {
          checkDigit = 1;
        } else if (remainder === 1) {
          checkDigit = 0;
        } else {
          checkDigit = 11 - remainder;
        }

        newAccount += checkDigit;
        result += newAccount + "<br>";
        lastSixNum = String(parseInt(lastSixNum) + 1).padStart(6, "0");
      }

      $("#result").html(result);
    }
  </script>
</body>
</html>
