<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>帳號產生程式</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h1>帳號產生程式</h1>
  <form id="accountForm">
    <label for="startAccount">起始帳號：</label>
    <input type="text" id="startAccount" name="startAccount" maxlength="11" required><br>

    <label for="accountCount">帳號數：</label>
    <input type="number" id="accountCount" name="accountCount" min="1" max="9999" required><br>

    <button type="submit">產生帳號</button>
  </form>

  <div id="output"></div>

  <script>
    $(document).ready(function() {
      $("#accountForm").submit(function(event) {
        event.preventDefault();

        var startAccount = $("#startAccount").val();
        var accountCount = parseInt($("#accountCount").val());

        // 檢查起始帳號長度
        if (startAccount.length !== 11) {
          $("#output").text("起始帳號長度錯誤");
          return;
        }

        // 檢查起始帳號是否為數字
        if (!/^\d+$/.test(startAccount)) {
          $("#output").text("起始帳號需為數字");
          return;
        }

        // 分行別需為001-099，不得為019
        var branchCode = startAccount.substring(0, 3);
        if (!(branchCode >= "001" && branchCode <= "099") || branchCode === "019") {
          $("#output").text("分行別錯誤");
          return;
        }

        // 科目需為10 20 30 40 50 51 66 77 88
        var subjectCode = startAccount.substring(3, 5);
        if (!["10", "20", "30", "40", "50", "51", "66", "77", "88"].includes(subjectCode)) {
          $("#output").text("科目別錯誤");
          return;
        }

        // 檢查帳號數範圍
        if (accountCount < 1 || accountCount > 9999) {
          $("#output").text("帳號數錯誤");
          return;
        }

        // 生成帳號
        var outputText = "";
        for (var i = 0; i < accountCount; i++) {
          var currentAccount = parseInt(startAccount) + i;
          var checkCode = calculateCheckCode(currentAccount);
          outputText += currentAccount + checkCode + "<br>";
        }
        $("#output").html(outputText);
      });
    });

    // 計算檢查碼
    function calculateCheckCode(account) {
      var checkCode = 0;
      var weights = [5, 4, 3, 2, 8, 7, 6, 5, 4, 3, 2];

      // 計算 Y
      for (var i = 0; i < 11; i++) {
        checkCode += parseInt(account.toString()[i]) * weights[i];
      }

      var remainder = checkCode % 11;
      var z = remainder === 0 ? 1 : remainder === 1 ? 0 : 11 - remainder;

      return z.toString();
    }
  </script>
</body>
</html>
